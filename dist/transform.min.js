const ctlRe=/(?=[A-Z])/;function camelToLisp(t){return t.split(ctlRe).join("-").toLowerCase()}const attribs=["id","part","class","data","element","prop"];function getQuery(t){const e=camelToLisp(t);for(const t of attribs)if(e.endsWith(t)){const r=e.substr(0,e.length-t.length-1);switch(t){case"id":return{query:`#${r}`,type:t,attrib:r};case"part":return{query:`[part~="${r}"]`,type:t,attrib:r};case"class":return{query:`.${r}`,type:t,attrib:r};case"data":{const e=`data-${r}`;return{query:`[${e}]`,type:t,attrib:e}}case"element":return{query:r,type:t,attrib:r};case"prop":return{query:`[-${r}]`,type:t,attrib:r}}}return null}const stcRe=/(\-\w)/g;function lispToCamel(t){return t.replace(stcRe,(function(t){return t[1].toUpperCase()}))}function transform(t,e,r=t){e.ctx=e;const n=isTemplate(t),o=n?t.content.cloneNode(!0):t;processFragment(o,e);let c="appendChild";const a=e.options;if(void 0!==a){a.prepend&&(c="prepend");const t=a.initializedCallback;void 0!==t&&t(e,o,a)}return n&&r&&r[c](o),e.mode="update",e}function isTemplate(t){return void 0!==t&&"template"===t.localName&&t.content&&"function"==typeof t.content.cloneNode}function processFragment(t,e){const r=e.match;if(void 0===r)return;const n=Array.isArray(r)?r:[r],o=void 0===e.mode;for(var c of n){const r={level:0,idx:0};o&&(r.mode="init"),Object.assign(e,r),e.target=t,e.match=c,processTarget(e)}}function processTarget(t){const e=t.target,r=t.match;if(null==e||void 0===r)return!0;11!==e.nodeType&&e.hasAttribute("debug");const n=Object.keys(r);if(0===n.length)return!0;const o=[];for(const c of n){const n=getQuery(c);if(null!==n)for(const o of e.querySelectorAll(n.query)){const{val:e,target:a}=t;switch(n.type){case"data":t.val=o.getAttribute(n.attrib);break;case"prop":o[lispToCamel(n.attrib)]=r[c];continue}t.target=o,doRHS(t,r[c]),t.val=e,t.target=a}else o.push(c)}for(const n of e.children)for(const c of o)n.matches(c)&&(t.target=n,doRHS(t,r[c]),t.target=e)}function doRHS(t,e){for(;"function"==typeof e;)e=e(t);const r=t.psm;if(void 0!==r){let n;switch(typeof e){case"string":n=r.find((t=>t.type===String))?.ctor;break;case"boolean":n=r.find((t=>t.type===Boolean))?.ctor;break;case"number":n=r.find((t=>t.type===Number))?.ctor;break;case"object":n=r.find((t=>t.type===Object))?.ctor;break;case"bigint":n=r.find((t=>t.type===BigInt))?.ctor;break;case"symbol":n=r.find((t=>t.type===Symbol))?.ctor}switch(typeof n){case"undefined":return;case"object":return n.do(t);case"function":return(new n).do(t)}}}export{isTemplate,transform};
