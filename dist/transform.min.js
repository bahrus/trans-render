const ctlRe=/(?=[A-Z])/;function camelToLisp(t){return t.split(ctlRe).join("-").toLowerCase()}const attribs=["id","part","class","data","element","prop"];function getQuery(t){const e=camelToLisp(t);for(const t of attribs)if(e.endsWith(t)){const r=e.substr(0,e.length-t.length-1);switch(t){case"id":return{query:`#${r}`,type:t,attrib:r};case"part":return{query:`[part~="${r}"]`,type:t,attrib:r};case"class":return{query:`.${r}`,type:t,attrib:r};case"data":{const e=`data-${r}`;return{query:`[${e}]`,type:t,attrib:e}}case"element":return{query:r,type:t,attrib:r};case"prop":return{query:`[-${r}]`,type:t,attrib:r}}}return null}const stcRe=/(\-\w)/g;function lispToCamel(t){return t.replace(stcRe,(function(t){return t[1].toUpperCase()}))}function transform(t,e,r=t){e.ctx=e;const o=isTemplate(t),n=o?t.content.cloneNode(!0):t;processFragment(n,e);let c="appendChild";const a=e.options;if(void 0!==a){a.prepend&&(c="prepend");const t=a.initializedCallback;void 0!==t&&t(e,n,a)}return o&&r&&r[c](n),e.mode="update",e}function isTemplate(t){return void 0!==t&&"template"===t.localName&&t.content&&"function"==typeof t.content.cloneNode}function processFragment(t,e){const r=e.match;if(void 0===r)return;const o=Array.isArray(r)?r:[r],n=void 0===e.mode;for(var c of o){const r={level:0,idx:0};n&&(r.mode="init"),Object.assign(e,r),e.target=t,e.match=c,processTarget(e)}}function processTarget(t){const e=t.target,r=t.match;if(null==e||void 0===r)return!0;11!==e.nodeType&&e.hasAttribute("debug");const o=Object.keys(r);if(0===o.length)return!0;const n=[];for(const c of o){const o=getQuery(c);if(null!==o)for(const n of e.querySelectorAll(o.query)){const{val:e,target:a}=t;switch(o.type){case"data":t.val=n.getAttribute(o.attrib);break;case"prop":n[lispToCamel(o.attrib)]=r[c];continue}t.target=n,doRHS(t,r[c]),t.val=e,t.target=a}else n.push(c)}for(const o of e.children)for(const c of n)o.matches(c)&&(t.target=o,doRHS(t,r[c]),t.target=e)}function doRHS(t,e){if(void 0===e)return;for(;"function"==typeof e;)e=e(t);const r=t.psm;if(void 0!==r){let o;switch(typeof e){case"string":o=r.find((t=>t.type===String))?.ctor;break;case"boolean":o=r.find((t=>t.type===Boolean))?.ctor;break;case"number":o=r.find((t=>t.type===Number))?.ctor;break;case"object":o=(Array.isArray(e)?r.find((t=>t.type===Array))?.ctor:void 0)||(isTemplate(e)?r.find((t=>t.type===HTMLTemplateElement))?.ctor:void 0)||r.find((t=>t.type===Object))?.ctor;break;case"bigint":o=r.find((t=>t.type===BigInt))?.ctor;break;case"symbol":o=r.find((t=>t.type===Symbol))?.ctor}switch(typeof o){case"undefined":return;case"object":{const r=t.rhs;t.rhs=e,doRHS(t,o.do(t)),t.rhs=r}break;case"function":{const r=new o;t.rhs;t.rhs=e,doRHS(t,r.do(t))}}}}export{isTemplate,transform};
