export function init(template,ctx){const transformScriptSelector="script[transform]",clonedTemplate=template.content.cloneNode(!0);if(ctx.template=clonedTemplate,!ctx.transform){const scriptTransform=clonedTemplate.querySelector(transformScriptSelector);if(null===scriptTransform)throw"Transform Required";ctx.transform=eval(scriptTransform.innerHTML),scriptTransform.remove()}const children=clonedTemplate.children;for(let e=0,t=children.length;e<t;e++){const t=children[e],r={model:ctx.model,leaf:t};Object.assign(ctx,r),ctx.level=0,ctx.stack=[r],process(ctx)}return ctx}function process(e){const t=e.leaf;if(void 0===t.matches)return;const r=e.transform,c=t.children,n=c.length;for(const o in r)if(t.matches(o)){const l=r[o];if(e.matchChildren=!1,l({target:t,ctx:e}),e.matchChildren&&n>0){e.level++;for(let r=0;r<n;r++){const n=c[r];e.leaf=n,process(e),e.leaf=t}e.level--}}}